<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestione Clienti</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f0f8ff; /* Colore di sfondo */
        }
        .container {
            max-width: 800px; /* Limita la larghezza per una migliore leggibilit√† */
            margin: auto; /* Centra il contenuto */
            padding-top: 50px; /* Aggiunge spazio sopra il contenuto */
        }
        h1 {
            text-align: center; /* Centra il titolo */
            margin-bottom: 30px; /* Aggiunge spazio sotto il titolo */
        }
        form {
            background-color: #fff; /* Sfondo del form */
            padding: 20px; /* Aggiunge spazio interno al form */
            border-radius: 10px; /* Bordo arrotondato */
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1); /* Ombra leggera */
        }
        form label {
            font-weight: bold; /* Testo in grassetto per le etichette */
        }
        form input {
            margin-bottom: 15px; /* Aggiunge spazio tra gli input */
        }
        #searchInput {
            margin-bottom: 20px; /* Aggiunge spazio sotto il campo di ricerca */
        }
        table {
            width: 100%; /* Rendi la tabella larga quanto il contenitore */
            background-color: #fff; /* Sfondo della tabella */
            border-radius: 10px; /* Bordo arrotondato */
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1); /* Ombra leggera */
        }
        table th, table td {
            padding: 10px; /* Aggiunge spazio interno alle celle */
            text-align: center; /* Centra il testo nelle celle */
        }
        table th:last-child, table td:last-child {
            text-align: right; /* Allinea gli elementi dell'ultima colonna a destra */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Gestione Clienti</h1>

        <form id="clienteForm">
            <input type="hidden" id="id" name="id">
            <div class="mb-3">
                <label for="nome" class="form-label">Nome</label>
                <input type="text" class="form-control" id="nome" name="nome" required>
            </div>
            <div class="mb-3">
                <label for="cognome" class="form-label">Cognome</label>
                <input type="text" class="form-control" id="cognome" name="cognome" required>
            </div>
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" name="email" required>
            </div>
            <div class="mb-3">
                <label for="residenza" class="form-label">Residenza</label>
                <input type="text" class="form-control" id="residenza" name="residenza" required>
            </div>
            <div class="mb-3">
                <label for="codiceFiscale" class="form-label">Codice Fiscale</label>
                <input type="text" class="form-control" id="codiceFiscale" name="codiceFiscale" required>
            </div>
            <button type="submit" class="btn btn-primary">Aggiungi/Modifica Cliente</button>
        </form>

        <hr>

        <!-- Ricerca cliente -->
        <input type="text" class="form-control mb-3" id="searchInput" placeholder="Cerca cliente...">

        <!-- Tabella clienti -->
        <table class="table">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Cognome</th>
                    <th>Email</th>
                    <th>Residenza</th>
                    <th>Codice Fiscale</th>
                    <th>Azioni</th>
                </tr>
            </thead>
            <tbody id="clienteTableBody"></tbody>
        </table>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        const clienteForm = document.getElementById('clienteForm');
        const searchInput = document.getElementById('searchInput');
        const clienteTableBody = document.getElementById('clienteTableBody');

        const fetchClienti = async () => {
            try {
                const response = await axios.get('/api/clienti/prova');
                const clienti = response.data;
                renderClientTable(clienti);
            } catch (error) {
                console.error('Errore nel recupero dei clienti:', error);
            }
        };

        const saveOrUpdateCliente = async (event) => {
            event.preventDefault();
            const id = document.getElementById('id').value;
            const nome = document.getElementById('nome').value;
            const cognome = document.getElementById('cognome').value;
            const email = document.getElementById('email').value;
            const residenza = document.getElementById('residenza').value;
            const codiceFiscale = document.getElementById('codiceFiscale').value;

            const cliente = { id, nome, cognome, email, residenza, codiceFiscale };

            try {
                if (id) {
                    await axios.put(`/api/clienti/prova/${id}`, cliente);
                    const submitBtn = document.querySelector('#clienteForm button[type="submit"]');
                    submitBtn.textContent = 'Aggiungi Cliente';
                } else {
                    await axios.post('/api/clienti/prova', cliente);
                }
                clienteForm.reset();
                fetchClienti();
            } catch (error) {
                console.error('Errore nel salvataggio o nell\'aggiornamento del cliente:', error);
            }
        };

        const editCliente = async (id) => {
            try {
                const response = await axios.get(`/api/clienti/prova/${id}`);
                const cliente = response.data;
                document.getElementById('id').value = cliente.id;
                document.getElementById('nome').value = cliente.nome;
                document.getElementById('cognome').value = cliente.cognome;
                document.getElementById('email').value = cliente.email;
                document.getElementById('residenza').value = cliente.residenza;
                document.getElementById('codiceFiscale').value = cliente.codiceFiscale;
                const submitBtn = document.querySelector('#clienteForm button[type="submit"]');
                submitBtn.textContent = 'Modifica';
            } catch (error) {
                console.error('Errore nel recupero del cliente:', error);
            }
        };

        const deleteCliente = async (id) => {
            try {
                await axios.delete(`/api/clienti/prova/${id}`);
                fetchClienti();
            } catch (error) {
                console.error('Errore nella cancellazione del cliente:', error);
            }
        };

        const renderClientTable = (clienti) => {
            clienteTableBody.innerHTML = '';
            const searchTerm = searchInput.value.toLowerCase();
            const filteredClients = clienti.filter(cliente => {
                return cliente.nome.toLowerCase().includes(searchTerm) ||
                       cliente.cognome.toLowerCase().includes(searchTerm) ||
                       cliente.email.toLowerCase().includes(searchTerm) ||
                       cliente.residenza.toLowerCase().includes(searchTerm) ||
                       cliente.codiceFiscale.toLowerCase().includes(searchTerm);
            });
            filteredClients.sort((a, b) => a.nome.localeCompare(b.nome));
            filteredClients.forEach(cliente => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${cliente.nome}</td>
                    <td>${cliente.cognome}</td>
                    <td>${cliente.email}</td>
                    <td>${cliente.residenza}</td>
                    <td>${cliente.codiceFiscale}</td>
                    <td>
                        <button type="button" class="btn btn-sm btn-primary" onclick="editCliente(${cliente.id})">Modifica</button>
                        <button type="button" class="btn btn-sm btn-danger" onclick="deleteCliente(${cliente.id})">Elimina</button>
                    </td>
                `;
                clienteTableBody.appendChild(tr);
            });
        };

        clienteForm.addEventListener('submit', saveOrUpdateCliente);
        searchInput.addEventListener('input', fetchClienti);

        fetchClienti();
    </script>
</body>
</html>
